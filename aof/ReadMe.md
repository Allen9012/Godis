在进行AOF重写操作时需要满足两个要求:

若 AOF 重写失败或被中断，AOF 文件需保持重写之前的状态不能丢失数据
进行 AOF 重写期间执行的命令必须保存到新的AOF文件中, 不能丢失
因此我们设计了一套比较复杂的流程：

暂停AOF写入 -> 更改状态为重写中 -> 准备重写 -> 恢复AOF写入
重写协程读取 AOF 文件中的前一部分（重写开始前的数据，不包括读写过程中写入的数据）并重写到临时文件（tmp.aof）中
暂停AOF写入 -> 将重写过程中产生的新数据  写入tmp.aof -> 使用临时文件tmp.aof覆盖AOF文件（使用文件系统的mv命令保证安全 -> 恢复AOF写入